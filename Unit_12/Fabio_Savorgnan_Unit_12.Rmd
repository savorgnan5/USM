---
title: "Unit_12"
author: "Fabio"
date: "7/23/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r, message=F, warning = F, echo=TRUE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape2)
library(tidyverse)
library(stringr)
library(caret)
library(fpp2)
library(dygraphs)
library(xts)
library(pander)
```

#### EuStockMarkets. Pull the DAX index

```{r, message=F, warning = F, echo=TRUE}
tsData <- EuStockMarkets
daxind <- tsData[,1]
head(daxind)

```

### Rudimentary Plot

```{r, message=F, warning = F, echo=TRUE}
plot(daxind, main="German Daily Closing Prices",xlab="Year", ylab="Closing Prices", col = "blue") +
  abline(v = 1997, col = "red", lty = 1, lwd = 2)
```
### Decompose the times series into its components

```{r, message=F, warning = F, echo=TRUE}
tsData <- EuStockMarkets[, 1] # ts data
decomposedRes <- decompose(tsData, type="mult") # use type = "additive" for additive components
plot (decomposedRes,col = "blue" ) + 
  abline(v = 1997, col = "red", lty = 1, lwd = 2) # see plot below
stlRes <- stl(tsData, s.window = "periodic")
```

### Exploring and subseting the maxtemp ftom the fpp2 library. We are only interested in data from 1990, we eliminated previous data.The original dataset goes back to 1970.
```{r, message=F, warning = F, echo=TRUE}
data<- maxtemp
maxtemp1990 <- window(data, start = 1990, end = 2016)
maxtemp1990 
```

### SES model. Data plot

```{r, message=F, warning = F, echo=TRUE}
plot(maxtemp1990, ylab = "Max Temperature", xlab = "Year")
fit1 = ses(maxtemp1990,initial = "simple",alpha = .2, h = 5)
```


### Fitted, predicted and forecasting plot
```{r, message=F, warning = F, echo=TRUE}
plot(maxtemp1990, ylab = "Max Temperature", xlab = "Year", type = "o", xlim = c(1990, 2021))
lines(fitted(fit1), col = "blue", type = "o")
lines(fit1$mean, col = "blue", type = "o")
```


### Statistics for the SES model. It will be compared to the holt model, please see below.

```{r, message=F, warning = F, echo=TRUE}
fit1$model
ASE <- accuracy(fitted(fit1), maxtemp1990)
ASE
ASEx<- ASE[,2]^2
ASEx
```



```{r, message=F, warning = F, echo=TRUE}
plot(maxtemp1990, ylab = "Max Temperature", xlab = "Year", type = "o", xlim = c(1990, 2021))
fit1h = holt(maxtemp1990, alpha = .8, beta = .2, damped = TRUE, initial = "optimal", h = 5)
lines(fitted(fit1h), col = "blue", type= "o")
lines(fit1h$mean,col = "darkgreen", type= "o")
```



#### The RMES is lower in the SES model fit1, which look like better model than the fit1h which is the holt model. The RMES in the holt model is 2.991645, the RMES in the SES model is 1.18444. Therefore the SES model could perform better from that prospective.The ASE ( please see above code 83 and this code) is lower in the SES model (fit1) ASEhx= 5.412085 in comparison to fith1 (holt model) ASE1x = 8.949939. With this information, the SES model should perform better. 
```{r, message=F, warning = F, echo=TRUE}
fit1h$model
ASEh <- accuracy(fitted(fit1h), maxtemp1990)
ASEh
ASEhx <- ASEh[,2]^2
ASEhx
```


### In this code we showed that fit1h has les residual than the fit1 model so from that prospective fit1h model should perform better than fit1. So the holt model should perform better than the SES model. This is in contrary to the ASE and RMES measures that we got above. 
```{r, message=F, warning = F, echo=TRUE}
fit1e <- mean(fit1$residuals)
fit1e
fit1he <-mean(fit1h$residuals)
fit1he
```


### Get the data.

```{r, message=F, warning = F, echo=TRUE}
Olli <- read.csv("Unit12TimeSeries_Ollivander.csv", header=FALSE)
head(Olli)
Grego <- read.csv("Unit12TimeSeries_Gregorovitch.csv", header=FALSE)
head(Grego)
```


### Converting Data time character to data time appropriate format.

```{r, message=F, warning = F, echo=TRUE}
Olli$V1 <- as.Date(Olli$V1,"%m/%d/%Y")
Olli$V1
Grego$V1 <- as.Date(Grego$V1,"%m/%d/%Y")
Olli$V1
```


### Convert to Time Series Object.

```{r, message=F, warning = F, echo=TRUE}
OlliTS <- xts(Olli$V2,order.by=Olli$V1)
GregoTS <- xts(Grego$V2,order.by=Grego$V1)
head(OlliTS)
autoplot(GregoTS)
head(GregoTS)
autoplot(GregoTS)
```

### WE combined the 2 times series

```{r, message=F, warning = F, echo=TRUE}
combined<- cbind(OlliTS, GregoTS)
head(combined)
```


#### Plot the combined time series.

```{r, message=F, warning = F, echo=TRUE}
dygraph(combined,main="Wand Sales by Maker",xlab="Date",ylab="Sales") %>%
  dySeries("OlliTS", label="Ollivander", col="blue") %>%
  dySeries("GregoTS", label="Gregorovitch",col="orange") %>%
  dyOptions(stackedGraph = TRUE)%>%
  dyRangeSelector() %>%
  dyShading(from="1995-01-01",to="1999-07-31") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth =3))%>% 
  dyLegend(width=500)
```







